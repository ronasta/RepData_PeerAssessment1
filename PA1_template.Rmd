---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## (1) Loading and preprocessing the data

> The data for this assignment can be downloaded from the course web site:  
> • Dataset: Activity monitoring data [52K]  
  
> The variables included in this dataset are:  
> • steps: Number of steps taking in a 5-minute interval (missing values are coded as NA)  
> • date: The date on which the measurement was taken in YYYY-MM-DD format  
> • interval: Identifier for the 5-minute interval in which measurement was taken  
 
> The dataset is stored in a comma-separated-value (CSV) file and there are a  
> total of 17,568 observations in this dataset.  
  

```{r 1-getData}

# set variables
url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
zipFile <- "activity.zip"
csvFile <- "activity.csv"

# download and unzip the data file
download.file(url,zipFile,method="curl")
unzip(zipFile, setTimes=TRUE)

# read the csv data file into a data.table
library(data.table)
ACTIVITY <- as.data.table(read.csv(csvFile))
setkeyv(ACTIVITY, c('date','interval'))
tables()

```


## &nbsp;
## (2) What is mean total number of steps taken per day?

> For this part of the assignment, you can ignore the missing values in the dataset. 

```{r q2-0}

A_ign_na <- ACTIVITY[complete.cases(ACTIVITY), ]

```

     
> **1. Make a histogram of the total number of steps taken each day**

```{r q2-1}

hist(A_ign_na[, sum(steps), by=date]$V1,
     breaks=15,
     main="plot 2-1:\nHistogram of the total number of steps taken each day",
     xlab="Sum of steps per day")

```

> **2. Calculate and report the mean and median total number of steps taken per day**

```{r q2-2, results='hold'}

print(sprintf("%-15.15s: %.2f", "the mean is", mean(A_ign_na[, sum(steps), by=date]$V1)))
print(sprintf("%-15.15s: %d", "the median is", median(A_ign_na[, sum(steps), by=date]$V1)))

```

## &nbsp;
## (3) What is the average daily activity pattern?

> **1. Make a time series plot (i.e. type = "l") of the 5-minute interval (x-axis)
and the average number of steps taken, averaged across all days (y-axis)**

```{r q3-1}

A <- A_ign_na[, mean(steps), by=interval]
plot(x=A$interval, y=A$V1,
     type="l",
     main="plot 3-1:\nAverage number of steps per 5-minute interval",
     xlab="# of 5-minute interval",
     ylab="mean(steps)")

```


> **2. Which 5-minute interval, on average across all the days in the dataset,
contains the maximum number of steps?**

```{r q3-2}

# maxInt <- A[which.max(A[,V1])]$interval
print(paste("it is the interval number", A[which.max(A[,V1])]$interval))

```

## &nbsp;
## (4) Imputing missing values

> Note that there are a number of days/intervals where there are missing values
(coded as NA). The presence of missing days may introduce bias into some
calculations or summaries of the data.


> **1. Calculate and report the total number of missing values in the dataset
> (i.e. the total number of rows with NAs**

```{r q4-1, results='hold'}

print(paste("there are", dim(ACTIVITY[is.na(steps)])[1], "missing steps (rows with steps=NA)"))

# check also whether we have all dates and all intervals for each day
print(paste("are there missing dates/intervals?", dim(ACTIVITY)[1] != (31+30)*(24*12)))

```

> **2. Devise a strategy for filling in all of the missing values in the dataset. The
> strategy does not need to be sophisticated. For example, you could use
> the mean/median for that day, or the mean for that 5-minute interval, etc**

As the plot 3-1 above shows a rather inequal  distribution, the imputed value 
should consider this average. In order to not jeopardize the
question about differences in the pattern for weekdays and weekends (5-1), the average per interval will be calculated seperatly for weekdays/weekends.

In anticipation of task 5-1, the variable `typeDay` with two levels – “weekday” and “weekend” will be inserted here into the dataset:

```{r q4-2, results='hide'}

# get English day names
Sys.setlocale(category = "LC_TIME", locale="C")

# insert Day name column and typeDay column as "weekday"
ACTIVITY[, `:=`(Day=weekdays(as.Date(date),abbreviate=TRUE), typeDay="weekday")]
# set typeDay to "weekend" for Saturdays and Sundays
ACTIVITY[Day %in% c("Sat","Sun"), typeDay:="weekend"]

```

> **3. Create a new dataset that is equal to the original dataset but with the
> missing data filled in.**

```{r q4-3, results='hide'}

# set the key to "i" column for join (save the actual key)
Akey <- key(ACTIVITY)
setkey(ACTIVITY, interval)

# create data tables with average steps per interval
# for weekends WE and weekdays WD (key() will be "i")
WE <- ACTIVITY[typeDay=="weekend" & !is.na(steps), mean(steps), by=interval]
WD <- ACTIVITY[typeDay=="weekday" & !is.na(steps), mean(steps), by=interval]

# for comparison, copy steps column to naSteps (steps with NA values)
ACTIVITY[, naSteps:=steps]

# join in the WE/WD tables, rename their V1 column to dE/vD
ACTIVITY <- ACTIVITY[WE][,`:=`(vE=V1,V1=NULL)]
ACTIVITY <- ACTIVITY[WD][,`:=`(vD=V1,V1=NULL)]

# overwrite the NA steps by respective mean
ACTIVITY[typeDay=="weekend" & is.na(steps), steps:=as.integer(round(vE))]
ACTIVITY[typeDay=="weekday" & is.na(steps), steps:=as.integer(round(vD))]

# reset original key on ACTIVITY
setkeyv(ACTIVITY, Akey)

```
```{r q4-3a}

# show some example result lines
ACTIVITY[c(1,500,1100,9800,10000), ]

```



> **4. Make a histogram of the total number of steps taken each day and Calculate
> and report the mean and median total number of steps taken per day.**  
> Do these values differ from the estimates from the first part of the assignment?  
> What is the impact of imputing missing data on the estimates of the total
> daily number of steps?


## &nbsp;
## (5) Are there differences in activity patterns between weekdays and weekends?

> For this part the weekdays() function may be of some help here. Use the dataset
> with the filled-in missing values for this part.  

> **1. Create a new factor variable in the dataset with two levels – “weekday”
> and “weekend” indicating whether a given date is a weekday or weekend
> day**


> **2. Make a panel plot containing a time series plot (i.e. type = "l") of the
> 5-minute interval (x-axis) and the average number of steps taken, averaged
> across all weekday days or weekend days (y-axis).**



